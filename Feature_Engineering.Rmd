---
title: "Untitled"
output: html_document
date: "2025-03-14"
---
```{r}
library(shiny)
library(dplyr)
library(ggplot2)

# Define UI
ui <- fluidPage(
  titlePanel("Feature Engineering in R Shiny"),
  
  sidebarLayout(
    sidebarPanel(
      h4("Feature Engineering"),
      
      # File upload
      fileInput("file", "Upload CSV File", accept = ".csv"),
      
      # New feature creation
      textInput("new_feature_expr", "New Feature Expression (e.g., column1 + column2)", ""),
      textInput("new_feature_name", "New Feature Name", ""),
      actionButton("apply_new_feature", "Create New Feature"),
      
      # Transformations on existing features
      selectInput("transform_column", "Select Column for Transformation", choices = NULL),
      radioButtons("transformation_type", "Select Transformation",
                   choices = c("Logarithm" = "log", "Square Root" = "sqrt", "Square" = "square")),
      actionButton("apply_transformation", "Apply Transformation"),
      
      # Show plot of feature impact
      checkboxInput("show_plot", "Show Plot of Feature Impact", value = TRUE)
    ),
    
    mainPanel(
      tabsetPanel(
        tabPanel("Feature Engineering Results", tableOutput("feature_table")),
        tabPanel("Feature Impact Plot", plotOutput("feature_impact_plot"))
      )
    )
  )
)

# Define Server
server <- function(input, output, session) {
  data <- reactiveVal(NULL)
  
  # Load data
  observeEvent(input$file, {
    req(input$file)
    df <- read.csv(input$file$datapath)
    data(df)
    
    updateSelectInput(session, "transform_column", choices = colnames(df))
  })
  
  # Apply new feature generation
  observeEvent(input$apply_new_feature, {
    req(data(), input$new_feature_expr, input$new_feature_name)
    
    df <- data()
    new_feature_expr <- input$new_feature_expr
    new_feature_name <- gsub("\\s+", "_", input$new_feature_name)  # Replace spaces with underscores
    
    if (new_feature_name %in% colnames(df)) {
      showNotification("Feature name already exists! Choose a different name.", type = "error")
      return()
    }
    
    tryCatch({
      df[[new_feature_name]] <- eval(parse(text = new_feature_expr), df)
      data(df)
    }, error = function(e) {
      showNotification("Invalid expression! Ensure correct column names.", type = "error")
    })
  })
  
  # Apply transformations
  observeEvent(input$apply_transformation, {
    req(data(), input$transform_column, input$transformation_type)
    
    df <- data()
    col_name <- input$transform_column
    new_col_name <- paste0(col_name, "_", input$transformation_type)
    
    if (new_col_name %in% colnames(df)) {
      showNotification("Transformation already exists!", type = "error")
      return()
    }
    
    tryCatch({
      if (input$transformation_type == "log") {
        df[[new_col_name]] <- log(df[[col_name]] + 1)
      } else if (input$transformation_type == "sqrt") {
        df[[new_col_name]] <- sqrt(df[[col_name]])
      } else if (input$transformation_type == "square") {
        df[[new_col_name]] <- df[[col_name]]^2
      }
      
      data(df)
    }, error = function(e) {
      showNotification("Transformation error! Ensure numerical values.", type = "error")
    })
  })
  
  # Display the updated dataset
  output$feature_table <- renderTable({
    req(data())
    head(data(), 10)
  })
  
  # Display feature impact plot
  output$feature_impact_plot <- renderPlot({
    req(data(), input$show_plot, input$transform_column)
    
    df <- data()
    col_name <- input$transform_column
    transformed_col <- paste0(col_name, "_", input$transformation_type)
    
    if (transformed_col %in% colnames(df)) {
      ggplot(df, aes_string(x = col_name, y = transformed_col)) +
        geom_point(alpha = 0.6, color = "blue") +
        theme_minimal() +
        labs(title = paste("Impact of", input$transformation_type, "on", col_name),
             x = col_name, y = transformed_col)
    }
  })
}

# Run the application
shinyApp(ui = ui, server = server)
```

